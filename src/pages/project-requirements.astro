---
import Header from '../components/Header.tsx';
import '../styles/global.css';

const { service } = Astro.url.searchParams;
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>Project Requirements - NKScreates</title>
		<style>
			.requirements-hero {
				background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
				color: white;
				padding: 4rem 2rem;
				text-align: center;
				margin-bottom: 3rem;
			}

			.requirements-form {
				max-width: 900px;
				margin: 0 auto;
				background: var(--bg-primary);
				border-radius: var(--radius-2xl);
				padding: 3rem;
				box-shadow: var(--shadow-xl);
				border: 1px solid var(--border-color);
			}

			.form-section {
				margin-bottom: 2.5rem;
				padding: 2rem;
				background: var(--bg-secondary);
				border-radius: var(--radius-xl);
				border: 1px solid var(--border-light);
			}

			.form-section h3 {
				color: var(--text-primary);
				font-size: 1.25rem;
				font-weight: 600;
				margin-bottom: 1.5rem;
				display: flex;
				align-items: center;
				gap: 0.5rem;
			}

			.form-group {
				margin-bottom: 1.5rem;
			}

			.form-group label {
				display: block;
				font-weight: 600;
				margin-bottom: 0.5rem;
				color: var(--text-primary);
			}

			.form-group input,
			.form-group textarea,
			.form-group select {
				width: 100%;
				padding: 1rem;
				border: 2px solid var(--border-color);
				border-radius: var(--radius-lg);
				font-size: 1rem;
				background: var(--bg-primary);
				color: var(--text-primary);
				transition: border-color var(--transition-fast);
			}

			.form-group input:focus,
			.form-group textarea:focus,
			.form-group select:focus {
				outline: none;
				border-color: var(--primary-color);
				box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
			}

			.form-group textarea {
				resize: vertical;
				min-height: 120px;
			}

			.file-upload-area {
				border: 2px dashed var(--border-color);
				border-radius: var(--radius-lg);
				padding: 2rem;
				text-align: center;
				background: var(--bg-tertiary);
				transition: all var(--transition-fast);
				cursor: pointer;
				position: relative;
			}

			.file-upload-area:hover {
				border-color: var(--primary-color);
				background: var(--bg-secondary);
			}

			.file-upload-area.dragover {
				border-color: var(--primary-color);
				background: rgba(59, 130, 246, 0.05);
			}

			.upload-icon {
				width: 64px;
				height: 64px;
				margin: 0 auto 1rem;
				opacity: 0.6;
				color: var(--text-secondary);
			}

			.file-list {
				margin-top: 1rem;
				display: flex;
				flex-wrap: wrap;
				gap: 0.5rem;
			}

			.file-item {
				display: inline-flex;
				align-items: center;
				gap: 0.5rem;
				background: var(--bg-primary);
				padding: 0.5rem 0.75rem;
				border-radius: var(--radius-md);
				border: 1px solid var(--border-color);
				font-size: 0.9rem;
			}

			.file-item button {
				background: none;
				border: none;
				color: var(--text-tertiary);
				cursor: pointer;
				padding: 0;
				font-size: 1.2rem;
				line-height: 1;
			}

			.submit-section {
				text-align: center;
				padding-top: 2rem;
				border-top: 1px solid var(--border-color);
			}

			.submit-btn {
				background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
				color: white;
				border: none;
				padding: 1.25rem 3rem;
				border-radius: var(--radius-lg);
				font-size: 1.1rem;
				font-weight: 600;
				cursor: pointer;
				transition: all var(--transition-fast);
				box-shadow: var(--shadow-md);
			}

			.submit-btn:hover:not(:disabled) {
				transform: translateY(-2px);
				box-shadow: var(--shadow-lg);
			}

			.submit-btn:disabled {
				opacity: 0.6;
				cursor: not-allowed;
				transform: none;
			}

			.success-message {
				display: none;
				text-align: center;
				padding: 3rem 2rem;
				background: linear-gradient(135deg, #10B981, #059669);
				color: white;
				border-radius: var(--radius-2xl);
				margin-top: 2rem;
			}

			.success-icon {
				font-size: 4rem;
				margin-bottom: 1rem;
			}

			.progress-bar {
				width: 100%;
				height: 4px;
				background: var(--bg-tertiary);
				border-radius: 2px;
				overflow: hidden;
				margin-top: 1rem;
			}

			.progress-fill {
				height: 100%;
				background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
				width: 0%;
				transition: width 0.3s ease;
			}

			@media (max-width: 768px) {
				.requirements-hero {
					padding: 3rem 1rem;
				}

				.requirements-form {
					padding: 2rem 1.5rem;
				}

				.form-section {
					padding: 1.5rem;
				}
			}
		</style>
	</head>
	<body>
		<Header client:load />

		<!-- Hero Section -->
		<section class="requirements-hero">
			<div style="max-width: 1200px; margin: 0 auto;">
				<h1 style="font-size: clamp(2.5rem, 5vw, 4rem); font-weight: 800; margin-bottom: 1rem; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
					Project Requirements
				</h1>
				<p style="font-size: clamp(1.1rem, 2vw, 1.3rem); opacity: 0.9; max-width: 600px; margin: 0 auto;">
					{service ? `Requesting: ${service}` : 'Tell us about your vision so we can bring it to life with precision and creativity'}
				</p>
			</div>
		</section>

		<main style="max-width: 1200px; margin: 0 auto; padding: 0 2rem 4rem;">
			<!-- Requirements Form -->
			<div class="requirements-form">
				<form id="requirementsForm" enctype="multipart/form-data">
					<input type="hidden" name="service" value={service || ''} />

					<!-- Project Details Section -->
					<div class="form-section">
						<h3>
							<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" stroke="currentColor" stroke-width="2"/>
							</svg>
							Project Details
						</h3>

						<div class="form-group">
							<label for="projectTitle">Project Title *</label>
							<input
								type="text"
								id="projectTitle"
								name="projectTitle"
								required
								placeholder="e.g., Modern Logo Design for Tech Startup"
							/>
						</div>

						<div class="form-group">
							<label for="projectDescription">Project Description *</label>
							<textarea
								id="projectDescription"
								name="projectDescription"
								required
								rows="8"
								placeholder="Please provide detailed information about your project:

â€¢ What is the main objective?
â€¢ Who is your target audience?
â€¢ What style or aesthetic are you looking for?
â€¢ What is your timeline?
â€¢ Any specific requirements or preferences?
â€¢ Budget range (optional)
â€¢ Any references or inspiration?"
							></textarea>
						</div>
					</div>

					<!-- Reference Files Section -->
					<div class="form-section">
						<h3>
							<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" stroke="currentColor" stroke-width="2"/>
							</svg>
							Reference Files (Optional)
						</h3>

						<div class="form-group">
							<div class="file-upload-area" id="fileUploadArea">
								<input
									type="file"
									id="projectFiles"
									name="projectFiles"
									multiple
									accept="image/*,.pdf,.doc,.docx,.zip,.rar,.txt"
									style="display: none;"
								/>
								<svg class="upload-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<path d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
								</svg>
								<h4 style="margin: 0 0 0.5rem; color: var(--text-primary);">Upload Reference Files</h4>
								<p style="margin: 0; color: var(--text-secondary); font-size: 0.95rem;">
									Drag & drop files here or click to browse<br>
									<span style="color: var(--text-tertiary); font-size: 0.85rem;">
										Supported: Images, PDFs, Documents (Max 10MB total)
									</span>
								</p>
							</div>
							<div id="fileList" class="file-list"></div>
						</div>
					</div>

					<!-- Contact Information Section -->
					<div class="form-section">
						<h3>
							<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke="currentColor" stroke-width="2"/>
							</svg>
							Contact Information
						</h3>

						<div class="form-group">
							<label for="customerName">Full Name *</label>
							<input
								type="text"
								id="customerName"
								name="customerName"
								required
								placeholder="Your full name"
							/>
							<small style="color: var(--text-tertiary); display: block; margin-top: 0.25rem;">
								How should we address you?
							</small>
						</div>

						<div class="form-group">
							<label for="contactEmail">Email Address *</label>
							<input
								type="email"
								id="contactEmail"
								name="contactEmail"
								required
								placeholder="your.email@example.com"
							/>
							<small style="color: var(--text-tertiary); display: block; margin-top: 0.25rem;">
								We'll use this to send you updates about your project
							</small>
						</div>
					</div>

					<!-- Submit Section -->
					<div class="submit-section">
						<button type="submit" class="submit-btn" id="submitBtn">
							<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline; margin-right: 0.5rem;">
								<path d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
							Submit Requirements
						</button>
						<div class="progress-bar" id="progressBar" style="display: none;">
							<div class="progress-fill" id="progressFill"></div>
						</div>
					</div>
				</form>
			</div>

			<!-- Success Message -->
			<div id="successMessage" class="success-message">
				<div class="success-icon">ðŸŽ‰</div>
				<h2 style="margin-bottom: 1rem; font-size: 2rem;">Requirements Submitted Successfully!</h2>
				<p style="font-size: 1.1rem; margin-bottom: 2rem; opacity: 0.9;">
					Thank you for choosing NKScreates! We've received your project requirements and our team will review them within 24-48 hours.
				</p>
				<div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: var(--radius-lg); margin-bottom: 2rem;">
					<h3 style="margin-bottom: 1rem;">What happens next?</h3>
					<ul style="text-align: left; margin: 0; padding-left: 1.5rem;">
						<li>Our team reviews your requirements</li>
						<li>We prepare a detailed proposal with timeline & pricing</li>
						<li>You receive a personalized quote via email</li>
						<li>Upon approval, we begin your project immediately</li>
					</ul>
				</div>
				<div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
					<a href="/" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: rgba(255,255,255,0.2); color: white; text-decoration: none; border-radius: var(--radius-lg); font-weight: 500; backdrop-filter: blur(10px);">
						<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" stroke="currentColor" stroke-width="2"/>
						</svg>
						Back to Home
					</a>
					<a href="https://www.youtube.com/@itsnks7418" target="_blank" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: #FF0000; color: white; text-decoration: none; border-radius: var(--radius-lg); font-weight: 500;">
						<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
							<path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
						</svg>
						View My Work
					</a>
				</div>
			</div>
		</main>

		<script>
			document.addEventListener('DOMContentLoaded', function() {
				const form = document.getElementById('requirementsForm');
				const fileInput = document.getElementById('projectFiles');
				const fileUploadArea = document.getElementById('fileUploadArea');
				const fileList = document.getElementById('fileList');
				const submitBtn = document.getElementById('submitBtn');
				const progressBar = document.getElementById('progressBar');
				const progressFill = document.getElementById('progressFill');
				const successMessage = document.getElementById('successMessage');

				// File upload handling
				fileUploadArea.addEventListener('click', () => {
					fileInput.click();
				});

				fileUploadArea.addEventListener('dragover', (e) => {
					e.preventDefault();
					fileUploadArea.classList.add('dragover');
				});

				fileUploadArea.addEventListener('dragleave', () => {
					fileUploadArea.classList.remove('dragover');
				});

				fileUploadArea.addEventListener('drop', (e) => {
					e.preventDefault();
					fileUploadArea.classList.remove('dragover');

					const files = Array.from(e.dataTransfer.files);
					handleFiles(files);
				});

				fileInput.addEventListener('change', (e) => {
					const files = Array.from(e.target.files);
					handleFiles(files);
				});

				function handleFiles(files) {
					// Validate file types and sizes
					const validFiles = files.filter(file => {
						const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'application/zip', 'application/x-rar-compressed', 'text/plain'];
						const maxSize = 10 * 1024 * 1024; // 10MB

						if (!validTypes.includes(file.type)) {
							alert(`File type not supported: ${file.name}`);
							return false;
						}

						if (file.size > maxSize) {
							alert(`File too large: ${file.name} (max 10MB)`);
							return false;
						}

						return true;
					});

					// Create new FileList with valid files
					const dt = new DataTransfer();
					validFiles.forEach(file => dt.items.add(file));
					fileInput.files = dt.files;

					updateFileList(validFiles);
				}

				function updateFileList(files) {
					fileList.innerHTML = files.map((file, index) => `
						<div class="file-item">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2"/>
								<polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2"/>
							</svg>
							<span>${file.name}</span>
							<span style="color: var(--text-tertiary); font-size: 0.8rem;">(${(file.size / 1024 / 1024).toFixed(1)}MB)</span>
							<button type="button" onclick="removeFile(${index})" title="Remove file">Ã—</button>
						</div>
					`).join('');
				}

				window.removeFile = function(index) {
					const files = Array.from(fileInput.files);
					files.splice(index, 1);

					const dt = new DataTransfer();
					files.forEach(file => dt.items.add(file));
					fileInput.files = dt.files;

					updateFileList(files);
				};

				// Form submission
				form.addEventListener('submit', async function(e) {
					e.preventDefault();

					const formData = new FormData(form);

					// Show loading state
					const originalText = submitBtn.innerHTML;
					submitBtn.innerHTML = `
						<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="animation: spin 1s linear infinite;">
							<path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
						Submitting...
					`;
					submitBtn.disabled = true;

					// Show progress bar
					progressBar.style.display = 'block';
					progressFill.style.width = '0%';

					try {
						// Simulate progress
						let progress = 0;
						const progressInterval = setInterval(() => {
							progress += Math.random() * 15;
							if (progress > 90) progress = 90;
							progressFill.style.width = progress + '%';
						}, 200);

						const response = await fetch('/api/project-requirements', {
							method: 'POST',
							body: formData
						});

						clearInterval(progressInterval);
						progressFill.style.width = '100%';

						if (response.ok) {
							// Success animation
							setTimeout(() => {
								form.style.display = 'none';
								successMessage.style.display = 'block';
								successMessage.scrollIntoView({ behavior: 'smooth' });

								// Hide progress bar
								progressBar.style.display = 'none';
							}, 500);
						} else {
							const error = await response.text();
							alert('Failed to submit requirements: ' + error);
							progressBar.style.display = 'none';
						}
					} catch (error) {
						console.error('Submission error:', error);
						alert('Failed to submit requirements. Please check your internet connection and try again.');
						progressBar.style.display = 'none';
					} finally {
						submitBtn.innerHTML = originalText;
						submitBtn.disabled = false;
					}
				});
			});

			// Add spin animation for loading icon
			const style = document.createElement('style');
			style.textContent = `
				@keyframes spin {
					from { transform: rotate(0deg); }
					to { transform: rotate(360deg); }
				}
			`;
			document.head.appendChild(style);
		</script>
	</body>
</html>