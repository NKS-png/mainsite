---
import { supabase } from '../lib/supabase';
import Header from '../components/Header.tsx';
import '../styles/global.css';

const { data: products } = await supabase
  .from('products')
  .select('*');

// Group products by category
const categories = {
  animation: products?.filter(p => p.category === 'animation') || [],
  artwork: products?.filter(p => p.category === 'artwork') || [],
  video_editing: products?.filter(p => p.category === 'video_editing') || []
};
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>Store - NKScreates</title>
		<style>
			.store-hero {
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				color: white;
				padding: 4rem 2rem;
				text-align: center;
				position: relative;
				overflow: hidden;
			}

			.store-hero::before {
				content: '';
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.05"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
				opacity: 0.1;
			}

			.store-hero-content {
				position: relative;
				z-index: 1;
				max-width: 800px;
				margin: 0 auto;
			}

			.store-hero h1 {
				font-size: clamp(2.5rem, 5vw, 4rem);
				font-weight: 800;
				margin-bottom: 1rem;
				text-shadow: 0 2px 4px rgba(0,0,0,0.3);
			}

			.store-hero p {
				font-size: clamp(1.1rem, 2vw, 1.3rem);
				opacity: 0.9;
				margin-bottom: 2rem;
			}

			.store-stats {
				display: flex;
				justify-content: center;
				gap: 2rem;
				margin-top: 2rem;
				flex-wrap: wrap;
			}

			.stat-item {
				text-align: center;
			}

			.stat-number {
				font-size: 2rem;
				font-weight: 700;
				display: block;
			}

			.stat-label {
				font-size: 0.9rem;
				opacity: 0.8;
			}

			.store-main {
				max-width: 1400px;
				margin: 0 auto;
				padding: 3rem 2rem;
			}

			.category-section {
				margin-bottom: 4rem;
			}

			.category-header {
				display: flex;
				align-items: center;
				justify-content: space-between;
				margin-bottom: 2rem;
				flex-wrap: wrap;
				gap: 1rem;
			}

			.category-title {
				font-size: 2rem;
				font-weight: 700;
				color: #1f2937;
				margin: 0;
				display: flex;
				align-items: center;
				gap: 0.75rem;
			}

			.category-icon {
				width: 40px;
				height: 40px;
				background: linear-gradient(135deg, #667eea, #764ba2);
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				color: white;
			}

			.view-all-btn {
				background: #f3f4f6;
				color: #374151;
				border: none;
				padding: 0.75rem 1.5rem;
				border-radius: 0.5rem;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.2s;
			}

			.view-all-btn:hover {
				background: #667eea;
				color: white;
			}

			.products-grid {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
				gap: 2rem;
			}

			.product-card {
				background: white;
				border-radius: 1rem;
				box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
				overflow: hidden;
				transition: all 0.3s ease;
				border: 1px solid #e5e7eb;
			}

			.product-card:hover {
				transform: translateY(-4px);
				box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
			}

			.product-image {
				height: 200px;
				background: linear-gradient(135deg, #667eea, #764ba2);
				display: flex;
				align-items: center;
				justify-content: center;
				position: relative;
				overflow: hidden;
			}

			.product-image::before {
				content: '';
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="white" opacity="0.3"/><circle cx="80" cy="80" r="2" fill="white" opacity="0.3"/><circle cx="50" cy="30" r="1.5" fill="white" opacity="0.2"/></svg>');
			}

			.product-icon {
				width: 64px;
				height: 64px;
				color: white;
				opacity: 0.8;
				z-index: 1;
				position: relative;
			}

			.product-content {
				padding: 1.5rem;
			}

			.product-category {
				display: inline-block;
				background: #f3f4f6;
				color: #6b7280;
				padding: 0.25rem 0.75rem;
				border-radius: 9999px;
				font-size: 0.75rem;
				font-weight: 600;
				text-transform: uppercase;
				margin-bottom: 0.75rem;
			}

			.product-title {
				font-size: 1.25rem;
				font-weight: 700;
				color: #1f2937;
				margin-bottom: 0.5rem;
			}

			.product-description {
				color: #6b7280;
				line-height: 1.5;
				margin-bottom: 1.5rem;
			}

			.product-footer {
				display: flex;
				align-items: center;
				justify-content: space-between;
			}

			.product-price {
				font-size: 1.5rem;
				font-weight: 800;
				color: #1f2937;
			}

			.product-price .currency {
				font-size: 1rem;
				font-weight: 600;
				color: #6b7280;
			}

			.add-to-cart-btn {
				background: linear-gradient(135deg, #667eea, #764ba2);
				color: white;
				border: none;
				padding: 0.75rem 1.5rem;
				border-radius: 0.5rem;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.2s;
				display: flex;
				align-items: center;
				gap: 0.5rem;
			}

			.add-to-cart-btn:hover {
				transform: translateY(-1px);
				box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
			}

			.add-to-cart-btn:active {
				transform: translateY(0);
			}

			.empty-category {
				text-align: center;
				padding: 3rem 2rem;
				color: #6b7280;
			}

			.empty-category svg {
				width: 64px;
				height: 64px;
				margin: 0 auto 1rem;
				opacity: 0.5;
			}

			@media (max-width: 768px) {
				.store-hero {
					padding: 3rem 1rem;
				}

				.store-main {
					padding: 2rem 1rem;
				}

				.products-grid {
					grid-template-columns: 1fr;
					gap: 1.5rem;
				}

				.category-header {
					flex-direction: column;
					align-items: flex-start;
				}

				.store-stats {
					flex-direction: column;
					gap: 1rem;
				}
			}
		</style>
	</head>
	<body>
		<Header client:load />

		<!-- Hero Section -->
		<section class="store-hero">
			<div class="store-hero-content">
				<h1>Professional Creative Services</h1>
				<p>Transform your ideas into stunning visuals with our expert animation, artwork, and video editing services</p>

				<div class="store-stats">
					<div class="stat-item">
						<span class="stat-number">{products?.length || 0}</span>
						<span class="stat-label">Services Available</span>
					</div>
					<div class="stat-item">
						<span class="stat-number">24/7</span>
						<span class="stat-label">Support</span>
					</div>
					<div class="stat-item">
						<span class="stat-number">100%</span>
						<span class="stat-label">Satisfaction</span>
					</div>
				</div>
			</div>
		</section>

		<main class="store-main">
			<!-- Animation Services -->
			<section class="category-section">
				<div class="category-header">
					<h2 class="category-title">
						<div class="category-icon">
							<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M14.828 14.828a4 4 0 01-5.656 0M9 10h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" stroke="currentColor" stroke-width="2"/>
							</svg>
						</div>
						Animation Services
					</h2>
					<button class="view-all-btn" onclick="scrollToSection('animation')">View All</button>
				</div>

				<div class="products-grid" id="animation-grid">
					{categories.animation.length > 0 ? categories.animation.map(product => (
						<div class="product-card">
							<div class="product-image">
								<svg class="product-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<path d="M14.828 14.828a4 4 0 01-5.656 0M9 10h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" stroke="currentColor" stroke-width="2"/>
								</svg>
							</div>
							<div class="product-content">
								<span class="product-category">Animation</span>
								<h3 class="product-title">{product.name}</h3>
								<p class="product-description">{product.description}</p>
								<div class="product-footer">
									<div class="product-price">
										<span class="currency">₹</span>{product.price}
									</div>
									<button
										class="add-to-cart-btn"
										data-product-id={product.id}
										data-product-name={product.name}
										data-product-price={product.price}
										onclick="window.location.href='/project-requirements'"
									>
										<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
											<path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2"/>
										</svg>
										Request
									</button>
								</div>
							</div>
						</div>
					)) : (
						<div class="empty-category">
							<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M14.828 14.828a4 4 0 01-5.656 0M9 10h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" stroke="currentColor" stroke-width="2"/>
							</svg>
							<h3>No Animation Services Available</h3>
							<p>Check back soon for new animation packages!</p>
						</div>
					)}
				</div>
			</section>

			<!-- Artwork Services -->
			<section class="category-section">
				<div class="category-header">
					<h2 class="category-title">
						<div class="category-icon">
							<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" stroke="currentColor" stroke-width="2"/>
							</svg>
						</div>
						Digital Artwork
					</h2>
					<button class="view-all-btn" onclick="scrollToSection('artwork')">View All</button>
				</div>

				<div class="products-grid" id="artwork-grid">
					{categories.artwork.length > 0 ? categories.artwork.map(product => (
						<div class="product-card">
							<div class="product-image">
								<svg class="product-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" stroke="currentColor" stroke-width="2"/>
								</svg>
							</div>
							<div class="product-content">
								<span class="product-category">Artwork</span>
								<h3 class="product-title">{product.name}</h3>
								<p class="product-description">{product.description}</p>
								<div class="product-footer">
									<div class="product-price">
										<span class="currency">₹</span>{product.price}
									</div>
									<button
										class="add-to-cart-btn"
										data-product-id={product.id}
										data-product-name={product.name}
										data-product-price={product.price}
										onclick="window.location.href='/project-requirements'"
									>
										<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
											<path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2"/>
										</svg>
										Request
									</button>
								</div>
							</div>
						</div>
					)) : (
						<div class="empty-category">
							<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" stroke="currentColor" stroke-width="2"/>
							</svg>
							<h3>No Artwork Services Available</h3>
							<p>Check back soon for new artwork packages!</p>
						</div>
					)}
				</div>
			</section>

			<!-- Video Editing Services -->
			<section class="category-section">
				<div class="category-header">
					<h2 class="category-title">
						<div class="category-icon">
							<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<polygon points="23 7 16 12 23 17 23 7" stroke="currentColor" stroke-width="2"/>
								<rect x="1" y="5" width="15" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
							</svg>
						</div>
						Video Editing
					</h2>
					<button class="view-all-btn" onclick="scrollToSection('video')">View All</button>
				</div>

				<div class="products-grid" id="video-grid">
					{categories.video_editing.length > 0 ? categories.video_editing.map(product => (
						<div class="product-card">
							<div class="product-image">
								<svg class="product-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<polygon points="23 7 16 12 23 17 23 7" stroke="currentColor" stroke-width="2"/>
									<rect x="1" y="5" width="15" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
								</svg>
							</div>
							<div class="product-content">
								<span class="product-category">Video Editing</span>
								<h3 class="product-title">{product.name}</h3>
								<p class="product-description">{product.description}</p>
								<div class="product-footer">
									<div class="product-price">
										<span class="currency">₹</span>{product.price}
									</div>
									<button
										class="add-to-cart-btn"
										data-product-id={product.id}
										data-product-name={product.name}
										data-product-price={product.price}
										onclick="window.location.href='/project-requirements'"
									>
										<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
											<path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2"/>
										</svg>
										Request
									</button>
								</div>
							</div>
						</div>
					)) : (
						<div class="empty-category">
							<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<polygon points="23 7 16 12 23 17 23 7" stroke="currentColor" stroke-width="2"/>
								<rect x="1" y="5" width="15" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
							</svg>
							<h3>No Video Editing Services Available</h3>
							<p>Check back soon for new video editing packages!</p>
						</div>
					)}
				</div>
			</section>
		</main>

		<script src="/ui-controller.js" is:inline></script>
		<script src="/cart-manager.js" is:inline></script>
		<script>
			// Add to cart function
			function addToCart(button) {
				const productId = button.dataset.productId;
				const productName = button.dataset.productName;
				const productPrice = button.dataset.productPrice;

				if (window.cartManager && typeof window.cartManager.addPackage === 'function') {
					window.cartManager.addPackage(productId, productName, '₹' + productPrice);

					// Visual feedback
					const originalText = button.innerHTML;
					button.innerHTML = `
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
						Added!
					`;
					button.style.background = 'linear-gradient(135deg, #10b981, #059669)';

					setTimeout(() => {
						button.innerHTML = originalText;
						button.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
					}, 2000);
				} else {
					alert('Cart functionality not available. Please try again.');
				}
			}

			// Scroll to section function
			function scrollToSection(sectionId) {
				const element = document.getElementById(sectionId + '-grid') || document.querySelector(`.${sectionId}-section`);
				if (element) {
					element.scrollIntoView({ behavior: 'smooth', block: 'start' });
				}
			}

			// Make functions globally available
			window.addToCart = addToCart;
			window.scrollToSection = scrollToSection;

			// Initialize on load
			document.addEventListener('DOMContentLoaded', function() {
				console.log('Store page loaded with', products?.length || 0, 'products');
			});
		</script>
	</body>
</html>