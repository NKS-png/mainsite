---
import { supabase } from '../lib/supabase';
import '../styles/global.css';
import Header from '../components/Header.tsx';

const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;

// Get artwork portfolio data
const { data: uploads } = await supabase
	.from('uploads')
	.select('*')
	.eq('bucket', 'artwork')
	.eq('public', true)
	.order('created_at', { ascending: false });

const artworkItems = uploads || [];
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Artwork Portfolio - NKScreates</title>
		<style>
			/* Modern Artwork Portfolio Page - Glassmorphism Design */
			.artwork-page {
				min-height: 100vh;
				background: linear-gradient(180deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
				position: relative;
				overflow: hidden;
			}

			.artwork-page::before {
				content: '';
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: 
					radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
					radial-gradient(circle at 20% 80%, rgba(11, 121, 255, 0.08) 0%, transparent 50%);
				pointer-events: none;
				z-index: -1;
				animation: gradientShift 15s ease infinite;
			}

			@keyframes gradientShift {
				0%, 100% { opacity: 1; }
				50% { opacity: 0.8; }
			}

			.container {
				max-width: 1400px;
				margin: 0 auto;
				padding: 0 var(--spacing-6);
			}

			.header-section {
				padding: var(--spacing-20) 0 var(--spacing-12);
				position: relative;
				z-index: 1;
			}

			.header-content {
				display: flex;
				justify-content: space-between;
				align-items: center;
				flex-wrap: wrap;
				gap: var(--spacing-8);
			}

			.header-text h1 {
				font-size: clamp(3rem, 8vw, 4.5rem);
				background: linear-gradient(135deg, #8b5cf6, #7c3aed, #ec4899);
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
				background-clip: text;
				font-weight: 800;
				margin-bottom: var(--spacing-4);
				line-height: 1.1;
			}

			.header-text p {
				font-size: var(--font-size-lg);
				color: var(--text-secondary);
				max-width: 500px;
			}

			.home-btn {
				display: inline-flex;
				align-items: center;
				gap: var(--spacing-2);
				padding: var(--spacing-4) var(--spacing-8);
				background: rgba(255, 255, 255, 0.7);
				backdrop-filter: blur(10px);
				color: var(--text-primary);
				border: 2px solid rgba(139, 92, 246, 0.2);
				border-radius: var(--radius-full);
				font-weight: 600;
				text-decoration: none;
				transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
				cursor: pointer;
			}

			.home-btn:hover {
				background: rgba(255, 255, 255, 0.95);
				border-color: rgba(139, 92, 246, 0.5);
				transform: translateY(-3px);
				box-shadow: 0 10px 25px rgba(139, 92, 246, 0.2);
			}

			/* Gallery Section */
			.gallery-section {
				padding: var(--spacing-16) 0 var(--spacing-24);
				position: relative;
				z-index: 1;
			}

			.gallery-header {
				text-align: center;
				margin-bottom: var(--spacing-16);
			}

			.gallery-header h2 {
				font-size: clamp(2.5rem, 6vw, 4rem);
				margin-bottom: var(--spacing-4);
				color: var(--text-primary);
			}

			.gallery-description {
				max-width: 700px;
				margin: 0 auto;
				color: var(--text-secondary);
				font-size: var(--font-size-lg);
				line-height: 1.7;
			}

			.portfolio-grid {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
				gap: var(--spacing-8);
				animation: fadeInGrid 0.8s ease-out;
			}

			@keyframes fadeInGrid {
				from {
					opacity: 0;
					transform: translateY(20px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			.portfolio-item {
				background: rgba(255, 255, 255, 0.6);
				backdrop-filter: blur(20px);
				border: 1px solid rgba(255, 255, 255, 0.4);
				border-radius: var(--radius-3xl);
				overflow: hidden;
				transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
				display: flex;
				flex-direction: column;
				height: 100%;
				animation: slideUp 0.6s ease-out backwards;
			}

			.portfolio-item:nth-child(1) { animation-delay: 0.1s; }
			.portfolio-item:nth-child(2) { animation-delay: 0.2s; }
			.portfolio-item:nth-child(3) { animation-delay: 0.3s; }
			.portfolio-item:nth-child(n+4) { animation-delay: calc(0.3s + (var(--index, 0) - 3) * 0.1s); }

			@keyframes slideUp {
				from {
					opacity: 0;
					transform: translateY(30px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			.portfolio-item:hover {
				background: rgba(255, 255, 255, 0.85);
				border-color: rgba(139, 92, 246, 0.5);
				transform: translateY(-12px);
				box-shadow: 0 30px 60px rgba(139, 92, 246, 0.2);
			}

			.media-wrapper {
				position: relative;
				width: 100%;
				padding-top: 66.67%;
				overflow: hidden;
				background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(11, 121, 255, 0.1));
			}

			.media-wrapper video,
			.media-wrapper img {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				object-fit: cover;
				transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
			}

			.portfolio-item:hover .media-wrapper video,
			.portfolio-item:hover .media-wrapper img {
				transform: scale(1.08);
			}

			.portfolio-content {
				padding: var(--spacing-6);
				flex: 1;
				display: flex;
				flex-direction: column;
			}

			.portfolio-title {
				font-size: var(--font-size-xl);
				font-weight: 700;
				margin-bottom: var(--spacing-2);
				color: var(--text-primary);
			}

			.portfolio-meta {
				display: flex;
				gap: var(--spacing-4);
				margin-bottom: var(--spacing-4);
				font-size: var(--font-size-sm);
				color: var(--text-secondary);
				flex-wrap: wrap;
			}

			.portfolio-description {
				color: var(--text-secondary);
				font-size: var(--font-size-sm);
				flex: 1;
				margin-bottom: var(--spacing-4);
				line-height: 1.6;
			}

			.portfolio-action {
				display: inline-flex;
				align-items: center;
				gap: var(--spacing-2);
				padding: var(--spacing-3) var(--spacing-6);
				background: linear-gradient(135deg, #8b5cf6, #7c3aed);
				color: white;
				border: none;
				border-radius: var(--radius-full);
				cursor: pointer;
				font-weight: 600;
				font-size: var(--font-size-sm);
				transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
				text-decoration: none;
				width: fit-content;
			}

			.portfolio-action:hover {
				transform: translateY(-3px);
				box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
			}

			.empty-state {
				text-align: center;
				padding: var(--spacing-24) var(--spacing-8);
				background: rgba(255, 255, 255, 0.6);
				backdrop-filter: blur(20px);
				border: 2px dashed rgba(139, 92, 246, 0.2);
				border-radius: var(--radius-3xl);
				margin-top: var(--spacing-12);
			}

			.empty-state svg {
				width: 80px;
				height: 80px;
				margin-bottom: var(--spacing-4);
				color: var(--text-tertiary);
				opacity: 0.5;
			}

			.empty-state h3 {
				font-size: var(--font-size-2xl);
				margin-bottom: var(--spacing-2);
				color: var(--text-primary);
			}

			.empty-state p {
				color: var(--text-secondary);
				font-size: var(--font-size-base);
			}

			@media (max-width: 1024px) {
				.header-content {
					flex-direction: column;
					text-align: center;
				}

				.header-text h1 {
					font-size: clamp(2.5rem, 6vw, 3.5rem);
				}
			}

			@media (max-width: 768px) {
				.artwork-page {
					padding-top: var(--spacing-12);
				}

				.header-section {
					padding: var(--spacing-12) 0 var(--spacing-8);
				}

				.portfolio-grid {
					grid-template-columns: 1fr;
					gap: var(--spacing-6);
				}

				.gallery-header h2 {
					font-size: clamp(2rem, 5vw, 3rem);
				}
			}

			/* Fullscreen Modal Styles */
			.fullscreen-modal {
				position: fixed;
				top: 0;
				left: 0;
				width: 100vw;
				height: 100vh;
				z-index: 10000;
				display: none;
				align-items: center;
				justify-content: center;
			}

			.fullscreen-modal.active {
				display: flex;
			}

			.fullscreen-overlay {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.9);
				backdrop-filter: blur(10px);
				cursor: pointer;
			}

			.fullscreen-content {
				position: relative;
				max-width: 90vw;
				max-height: 90vh;
				display: flex;
				flex-direction: column;
				align-items: center;
				z-index: 10001;
			}

			.fullscreen-close {
				position: absolute;
				top: -60px;
				right: 0;
				background: rgba(255, 255, 255, 0.2);
				backdrop-filter: blur(10px);
				border: none;
				color: white;
				width: 50px;
				height: 50px;
				border-radius: 50%;
				cursor: pointer;
				display: flex;
				align-items: center;
				justify-content: center;
				transition: all 0.3s ease;
				z-index: 10002;
			}

			.fullscreen-close:hover {
				background: rgba(255, 255, 255, 0.3);
				transform: scale(1.1);
			}

			.fullscreen-media-container {
				position: relative;
				max-width: 100%;
				max-height: 80vh;
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.fullscreen-media {
				max-width: 100%;
				max-height: 100%;
				object-fit: contain;
				border-radius: var(--radius-lg);
				box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
			}

			.fullscreen-info {
				margin-top: var(--spacing-6);
				text-align: center;
				color: white;
			}

			.fullscreen-info h3 {
				font-size: var(--font-size-2xl);
				font-weight: 600;
				margin: 0;
			}

			@media (max-width: 768px) {
				.fullscreen-content {
					max-width: 95vw;
					max-height: 95vh;
				}

				.fullscreen-close {
					top: -50px;
					width: 40px;
					height: 40px;
				}

				.fullscreen-media-container {
					max-height: 70vh;
				}

				.fullscreen-info {
					margin-top: var(--spacing-4);
				}

				.fullscreen-info h3 {
					font-size: var(--font-size-xl);
				}
			}
		</style>
	</head>
	<body>
		<Header client:load />
		<div class="artwork-page">
			<div class="container">
				<!-- Header Section -->
				<div class="header-section">
					<div class="header-content">
						<div class="header-text">
							<h1>Digital Artwork Showcase</h1>
							<p>Premium digital art and creative illustrations</p>
						</div>
						<a href="/" class="home-btn">
							<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
							Home
						</a>
					</div>
				</div>

				<!-- Gallery Section -->
				<div class="gallery-section">
					<div class="gallery-header">
						<h2>My Artwork Collection</h2>
						<p class="gallery-description">
							Explore my collection of professional digital art and creative works
						</p>
					</div>

					{artworkItems.length > 0 ? (
						<div class="portfolio-grid">
							{artworkItems.map((item, index) => (
								<div class="portfolio-item" style={`--index: ${index + 1}`} data-src={`${supabaseUrl}/storage/v1/object/public/${item.bucket}/${encodeURIComponent(item.path)}`} data-type={item.mime.startsWith('video/') ? 'video' : 'image'} data-filename={item.filename}>
									<div class="media-wrapper">
										{item.mime.startsWith('video/') ? (
											<video
												src={`${supabaseUrl}/storage/v1/object/public/${item.bucket}/${encodeURIComponent(item.path)}`}
												controls
											/>
										) : (
											<img
												src={`${supabaseUrl}/storage/v1/object/public/${item.bucket}/${encodeURIComponent(item.path)}`}
												alt={item.filename}
											/>
										)}
									</div>
									<div class="portfolio-content">
										<h3 class="portfolio-title">{item.filename}</h3>
										<div class="portfolio-meta">
											<span>{new Date(item.created_at).toLocaleDateString()}</span>
										</div>
										<p class="portfolio-description">Premium artwork piece</p>
										<a href="#" class="portfolio-action">View Artwork</a>
									</div>
								</div>
							))}
						</div>
					) : (
						<div class="empty-state">
							<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
							<h3>No artwork yet</h3>
							<p>Digital artwork will be showcased here once uploaded</p>
						</div>
					)}
				</div>
			</div>
		</div>

		<!-- Fullscreen Modal -->
		<div id="fullscreen-modal" class="fullscreen-modal">
			<div class="fullscreen-overlay" id="fullscreen-overlay"></div>
			<div class="fullscreen-content">
				<button class="fullscreen-close" id="fullscreen-close">
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path d="M18 6L6 18M6 6l12 12"/>
					</svg>
				</button>
				<div class="fullscreen-media-container">
					<img id="fullscreen-image" class="fullscreen-media" style="display: none;" />
					<video id="fullscreen-video" class="fullscreen-media" controls style="display: none;">
						Your browser does not support the video tag.
					</video>
				</div>
				<div class="fullscreen-info">
					<h3 id="fullscreen-title"></h3>
				</div>
			</div>
		</div>

		<script>
			document.addEventListener('DOMContentLoaded', () => {
				const modal = document.getElementById('fullscreen-modal');
				const overlay = document.getElementById('fullscreen-overlay');
				const closeBtn = document.getElementById('fullscreen-close');
				const fullscreenImage = document.getElementById('fullscreen-image');
				const fullscreenVideo = document.getElementById('fullscreen-video');
				const fullscreenTitle = document.getElementById('fullscreen-title');

				// Add click listeners to portfolio items
				document.querySelectorAll('.portfolio-item').forEach(item => {
					const mediaWrapper = item.querySelector('.media-wrapper');
					const actionBtn = item.querySelector('.portfolio-action');

					// Click on media wrapper or action button
					[mediaWrapper, actionBtn].forEach(element => {
						if (element) {
							element.addEventListener('click', (e) => {
								e.preventDefault();
								openFullscreen(item);
							});
						}
					});
				});

				// Close modal functions
				const closeModal = () => {
					modal.classList.remove('active');
					// Pause video if playing
					if (fullscreenVideo) {
						fullscreenVideo.pause();
						fullscreenVideo.currentTime = 0;
					}
					// Reset body scroll
					document.body.style.overflow = '';
				};

				// Close on overlay click
				overlay.addEventListener('click', closeModal);

				// Close on close button click
				closeBtn.addEventListener('click', closeModal);

				// Close on Escape key
				document.addEventListener('keydown', (e) => {
					if (e.key === 'Escape' && modal.classList.contains('active')) {
						closeModal();
					}
				});

				// Open fullscreen function
				function openFullscreen(item) {
					const src = item.dataset.src;
					const type = item.dataset.type;
					const filename = item.dataset.filename;

					// Prevent body scroll
					document.body.style.overflow = 'hidden';

					// Set title
					fullscreenTitle.textContent = filename;

					// Show appropriate media
					if (type === 'video') {
						fullscreenImage.style.display = 'none';
						fullscreenVideo.style.display = 'block';
						fullscreenVideo.src = src;
						fullscreenVideo.load();
						fullscreenVideo.play().catch(e => console.log('Autoplay prevented:', e));
					} else {
						fullscreenVideo.style.display = 'none';
						fullscreenImage.style.display = 'block';
						fullscreenImage.src = src;
						fullscreenImage.alt = filename;
					}

					// Show modal
					modal.classList.add('active');
				}
			});
		</script>
	</body>
</html>
